<!DOCTYPE HTML >
<html lang="en">
<head>
<title >WebFTS - SSO + STS demo page</title >
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<script src="js/jquery.min.js"></script>
<script src="js/ssoHelper.js"></script>
<script src="js/lib/kjur-jsrsasign/jsrsasign-latest-all-min.js"></script>
<script>
function ready() {

// First of all we need to know the endpoint of our STS service

var sts;
$.get("config.xml", function(data) {
	sts = $(data).find('stsAddress').text();
});

// Now, we have to fetch an assertion from server side.

$.get("ssoGetAssertion.php", function(data) {

	// Let's check if we really got an assertion

	var err = ssoErrorString(data);
	if(err) {
		alert(err);
		return;
	}

	// We will now wrap fetched assertion in SOAP envelope
	// Third parameter to this function is an optional public key from our side (BASE64-encoded)

	var req = ssoSoapReq(data, sts);

	// We will now send our SOAP request to STS

	if(req) {
		$.ajax({url: "/sts",
		type: "POST",
		contentType: "text/xml; charset=utf-8",
		headers: {SOAPAction: sts},
		data: req}).done(
		function(data) {

			// Let's check if STS was happy with our assertion

			var err = ssoErrorString(data);
			if(err) {
				alert(err);
				return;
			}

			// This function returns BASE64-encoded string of generated certificate

			var cert = ssoGetCertificate(data);

			// This function returns BASE64-encoded string of generated private key

			var key = ssoGetPrivateKey(data);

			$("body").html("<pre>" + cert + "\n\n\n" + key + "\n\n\n" + ssoAuthString(cert, key) + "</pre>");
		});
	}
});
}
</script>
</head>
<body onload='ready()'>
Hello!
</body>
</html>
